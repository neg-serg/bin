#!/bin/zsh

local -a opts_=(
    "[Exit]"
    "[Usb passthrough add]"
    "[Usb passthrough del]"
    "[Start <Windows 10>]"
)

width_=800
yoffset_=40
rofi_cmd=(
    rofi
    -theme-str "'#window { width:${width_}; x-offset: 40; y-offset: ${yoffset_}; location: north west; anchor: north west; }'"
    -i -p "'[vm] >> '" -dmenu
)

case $(for opt in ${opts_}; do echo ${opt}; done | eval "${rofi_cmd[@]}") in
    *"Exit"*) 
        notify-send "[ Do ${res} ]"
    ;;
    *"Usb passthrough add"*)
        if pgrep qemu 2>/dev/null; then
            sudo st zsh -c -i "${HOME}/bin/qemu/usb-passthrough.sh add all"
        fi
    ;;
    *"Usb passthrough del"*)
        if pgrep qemu 2>/dev/null; then
            sudo st zsh -c -i "${HOME}/bin/qemu/usb-passthrough.sh del all"
        fi
        source ${XDG_CONFIG_HOME}/xinit/keyboard_and_mouse.zsh
    ;;
    *"Windows 10"*)
        os_name=${res:s_Start __}
        notify-send "Starting ... ${os_name}"
        sudo ~/bin/qemu/wrun || { notify-send "Start ${os_name} failed" && exit 1 }
        notify-send "Done"
    ;;
esac
